
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2. Create your cloud resources &#8212; BinderHub 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Set up BinderHub" href="setup-binderhub.html" />
    <link rel="prev" title="1. The BinderHub Architecture" href="diagram.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="diagram.html" title="previous chapter">Previous</a>
     <a class='right-next' href="setup-binderhub.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="create-your-cloud-resources">
<span id="create-cluster"></span><h1>2. Create your cloud resources<a class="headerlink" href="#create-your-cloud-resources" title="Permalink to this headline">¶</a></h1>
<p>BinderHub is built to run on top of Kubernetes, a distributed cluster manager.
It uses a JupyterHub to launch/manage user servers, as well as a
docker registry to cache images.</p>
<p>To create your own BinderHub, you’ll first need to set up a properly
configured Kubernetes Cluster on the cloud, and then configure the
various components correctly. The following instructions will assist you
in doing so.</p>
<div class="section" id="setting-up-kubernetes-on-google-cloud">
<h2>2.1. Setting up Kubernetes on <a class="reference external" href="https://cloud.google.com/">Google Cloud</a><a class="headerlink" href="#setting-up-kubernetes-on-google-cloud" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">BinderHub is built to be cloud agnostic, and can run on various cloud
providers (as well as bare metal). However, here we only provide
instructions for Google Cloud as it has been the most extensively-tested.
If you would like to help with adding instructions for other cloud
providers, <a class="reference external" href="https://github.com/jupyterhub/binderhub/issues">please contact us</a>!</p>
</div>
<p><a class="reference external" href="https://cloud.google.com/container-engine/">Google Container Engine</a>
(confusingly abbreviated to GKE) is the simplest and most common way of setting
up a Kubernetes Cluster. You may be able to receive <a class="reference external" href="https://cloud.google.com/free/">free credits</a> for trying it out. You will need to
connect your credit card or other payment method to your google cloud account.</p>
<ol class="arabic">
<li><p class="first">Go to <a class="reference external" href="https://console.cloud.google.com">https://console.cloud.google.com</a> and log in.</p>
</li>
<li><p class="first">Enable the <a class="reference external" href="https://console.cloud.google.com/apis/api/container.googleapis.com/overview">Container Engine API</a>.</p>
</li>
<li><p class="first">Use <strong>Google Cloud Shell</strong> (<a class="reference external" href="https://cloud.google.com/shell/docs/starting-cloud-shell">Google documentation</a>)
which will give you access to the <code class="docutils literal"><span class="pre">gcloud</span></code> command-line tool.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Alternatively, advanced users may wish to install the <code class="docutils literal"><span class="pre">gcloud</span></code> command-line
tool in the <a class="reference external" href="https://cloud.google.com/sdk/gcloud/">Google Cloud SDK</a>.
These tools send commands to Google Cloud and lets you do things like
create and delete clusters.</p>
</div>
</li>
<li><p class="first">Install <code class="docutils literal"><span class="pre">kubectl</span></code>, which is a tool for controlling kubernetes. From
Google Cloud shell (or a terminal for advanced users who have installed
<code class="docutils literal"><span class="pre">gcloud</span></code> using the SDK), enter:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud components install kubectl
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create a Kubernetes cluster on Google Cloud, by typing in the following
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gcloud container clusters create &lt;YOUR_CLUSTER&gt; <span class="se">\</span>
    --num-nodes<span class="o">=</span><span class="m">3</span> <span class="se">\</span>
    --machine-type<span class="o">=</span>n1-standard-2 <span class="se">\</span>
    --zone<span class="o">=</span>us-central1-b <span class="se">\</span>
    --cluster-version<span class="o">=</span><span class="m">1</span>.8.4-gke.1
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">--num-nodes</span></code> specifies how many computers to spin up. The higher the
number, the greater the cost.</li>
<li><code class="docutils literal"><span class="pre">--machine-type</span></code> specifies the amount of CPU and RAM in each node. There
is a <a class="reference external" href="https://cloud.google.com/compute/docs/machine-types">variety of types</a>
to choose from. Picking something appropriate here will have a large effect
on how much you pay - smaller machines restrict the max amount of RAM each
user can have access to but allow more fine-grained scaling, reducing cost.
The default (<code class="docutils literal"><span class="pre">n1-standard-2</span></code>) has 2CPUs and 7.5G of RAM each, and might not
be a good fit for all use cases!</li>
<li><code class="docutils literal"><span class="pre">--zone</span></code> specifies which data center to use. Pick something that is not
too far away from your users. You can find a list of them <a class="reference external" href="https://cloud.google.com/compute/docs/regions-zones/regions-zones#available">here</a>.</li>
</ul>
</li>
<li><p class="first">Give your account super-user permissions, allowing you to perform all
the actions needed to set up BinderHub</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>kubectl create clusterrolebinding cluster-admin-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span>&lt;my-email&gt;
</pre></div>
</div>
</li>
<li><p class="first">To test if your cluster is initialized, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>kubectl get node
</pre></div>
</div>
<p>The response should list three running nodes.</p>
</li>
</ol>
<p>Next we’ll install a few tools that are required for BinderHub to run properly.</p>
</div>
<div class="section" id="installing-helm">
<h2>2.2. Installing Helm<a class="headerlink" href="#installing-helm" title="Permalink to this headline">¶</a></h2>
<p>Next, we’ll install <strong>Helm</strong>. This allows us to control our Kubernetes cluster
with a configuration file (called a Helm Chart). By using a <strong>Helm Chart</strong>, we
can set up the cluster deployment to have the resources necessary for
running BinderHub.</p>
<p>First download and install helm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">helm</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">get</span> <span class="o">|</span> <span class="n">bash</span>
</pre></div>
</div>
<p>Next create a role and permissions for Helm within kubernetes by running
the following commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">--</span><span class="n">namespace</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span> <span class="n">create</span> <span class="n">sa</span> <span class="n">tiller</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">clusterrolebinding</span> <span class="n">tiller</span> <span class="o">--</span><span class="n">clusterrole</span> <span class="n">cluster</span><span class="o">-</span><span class="n">admin</span> <span class="o">--</span><span class="n">serviceaccount</span><span class="o">=</span><span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="p">:</span><span class="n">tiller</span>
</pre></div>
</div>
<p>Finally initialize Helm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">init</span> <span class="o">--</span><span class="n">service</span><span class="o">-</span><span class="n">account</span> <span class="n">tiller</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-container-registry">
<span id="setup-registry"></span><h2>2.3. Set up the container registry<a class="headerlink" href="#set-up-the-container-registry" title="Permalink to this headline">¶</a></h2>
<p>BinderHub will build Docker images out of GitHub repositories, and then push
them to a docker registry so that JupyterHub can launch user servers based
on these images.You can use any registry that
you like, though this guide covers how to properly configure the <strong>Google
Container Registry</strong> (<code class="docutils literal"><span class="pre">gcr.io</span></code>).</p>
<p>You need to provide BinderHub with proper credentials so it can push images
to the Google Container Registry. You can do so by creating a service
account that has authorization to push to Google Container Registry:</p>
<ol class="arabic simple">
<li>Go to <a class="reference external" href="http://console.cloud.google.com">console.cloud.google.com</a></li>
<li>Make sure your project is selected</li>
<li>Click <code class="docutils literal"><span class="pre">&lt;top-left</span> <span class="pre">menu</span> <span class="pre">w/</span> <span class="pre">three</span> <span class="pre">horizontal</span> <span class="pre">bars&gt;</span> <span class="pre">-&gt;</span> <span class="pre">IAM</span> <span class="pre">&amp;</span> <span class="pre">Admin</span> <span class="pre">-&gt;</span> <span class="pre">Service</span> <span class="pre">Accounts</span></code> menu option</li>
<li>Click <strong>Create service account</strong></li>
<li>Give your account a descriptive name such as “BinderHub-registry”</li>
<li>Click <code class="docutils literal"><span class="pre">Role</span> <span class="pre">-&gt;</span> <span class="pre">Storage</span> <span class="pre">-&gt;</span> <span class="pre">Storage</span> <span class="pre">Admin</span></code> menu option</li>
<li>Check <strong>Furnish new private key</strong></li>
<li>Leave key type as default of <strong>JSON</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p>These steps will download a <strong>JSON file</strong> to your computer. The JSON file
contains the password that can be used to push Docker images to the <code class="docutils literal"><span class="pre">gcr.io</span></code>
registry.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Don’t share the contents of this JSON file with anyone. It can be used to
gain access to your google cloud account!</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Make sure to store this JSON file as you cannot generate a second one
without re-doing the steps above.</p>
</div>
<p>Now that our cloud resources are set up, it’s time to <a class="reference internal" href="setup-binderhub.html"><span class="doc">Set up BinderHub</span></a>.</p>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="diagram.html" title="previous chapter">1. The BinderHub Architecture</a>
     <a class='right-next' href="setup-binderhub.html" title="next chapter">3. Set up BinderHub</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">BinderHub</a></h1>



<p class="blurb">A project to build and serve Binders</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=binderhub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="diagram.html">1. The BinderHub Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Create your cloud resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-kubernetes-on-google-cloud">2.1. Setting up Kubernetes on Google Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-helm">2.2. Installing Helm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-the-container-registry">2.3. Set up the container registry</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup-binderhub.html">3. Set up BinderHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">4. Debugging BinderHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">5. Tear down your Binder deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">6. BinderHub API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/ref-index.html">7. Configuration and Source Code Reference</a></li>
</ul>


<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="diagram.html" title="Previous">Previous topic</a></li>
  <li><a href="setup-binderhub.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/create-cloud-resources.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, The Jupyter Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/create-cloud-resources.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>