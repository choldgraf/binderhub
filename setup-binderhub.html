
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3. Set up BinderHub &#8212; BinderHub 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Debugging BinderHub" href="debug.html" />
    <link rel="prev" title="2. Create your cloud resources" href="create-cloud-resources.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class='prev-next-top'>
    
     <a class='left-prev' href="create-cloud-resources.html" title="previous chapter">Previous</a>
     <a class='right-next' href="debug.html" title="next chapter">Next</a>
  <div style='clear:both;'></div>

  </div>

  
  <div class="section" id="set-up-binderhub">
<h1>3. Set up BinderHub<a class="headerlink" href="#set-up-binderhub" title="Permalink to this headline">¶</a></h1>
<p>BinderHub uses Helm Charts to set up the applications we’ll use in our Binder
deployment. If you’re curious about what Helm Charts are and how they’re
used here, see the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/latest/tools.html#helm">Zero to JupyterHub guide</a>.</p>
<p>Below we’ll cover how to configure your Helm Chart, and how to create your
BinderHub deployment.</p>
<div class="section" id="preparing-to-install">
<h2>3.1. Preparing to install<a class="headerlink" href="#preparing-to-install" title="Permalink to this headline">¶</a></h2>
<p>To configure the Helm Chart we’ll need to generate several pieces of
information and insert them into <code class="docutils literal"><span class="pre">yaml</span></code> files.</p>
<p>First we’ll create a folder where we’ll store our BinderHub configuration
files. You can do so with the following commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">binderhub</span>
<span class="n">cd</span> <span class="n">binderhub</span>
</pre></div>
</div>
<p>Now we’ll collect the information we need to deploy our BinderHub.
The first is the content of the JSON file created when we set up
the container registry. For more information on getting a registry password, see
<a class="reference internal" href="create-cloud-resources.html#setup-registry"><span class="std std-ref">Set up the container registry</span></a>. We’ll copy/paste the contents of this file in the steps
below.</p>
<p>Create two random tokens by running the following commands then copying the
outputs.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">rand</span> <span class="o">-</span><span class="nb">hex</span> <span class="mi">32</span>
<span class="n">openssl</span> <span class="n">rand</span> <span class="o">-</span><span class="nb">hex</span> <span class="mi">32</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command is run <strong>twice</strong> because we need two different tokens.</p>
</div>
</div>
<div class="section" id="create-secret-yaml-file">
<h2>3.2. Create <code class="docutils literal"><span class="pre">secret.yaml</span></code> file<a class="headerlink" href="#create-secret-yaml-file" title="Permalink to this headline">¶</a></h2>
<p>Create a file called <code class="docutils literal"><span class="pre">secret.yaml</span></code> and enter the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">jupyterhub</span><span class="p">:</span>
    <span class="n">hub</span><span class="p">:</span>
      <span class="n">services</span><span class="p">:</span>
        <span class="n">binder</span><span class="p">:</span>
          <span class="n">apiToken</span><span class="p">:</span> <span class="s2">&quot;&lt;output of FIRST `openssl rand -hex 32` command&gt;&quot;</span>
    <span class="n">proxy</span><span class="p">:</span>
      <span class="n">secretToken</span><span class="p">:</span> <span class="s2">&quot;&lt;output of SECOND `openssl rand -hex 32` command&gt;&quot;</span>
<span class="n">registry</span><span class="p">:</span>
  <span class="n">password</span><span class="p">:</span> <span class="o">|</span>
    <span class="o">&lt;</span><span class="n">content</span> <span class="n">of</span> <span class="n">the</span> <span class="n">JSON</span> <span class="n">file</span> <span class="n">downloaded</span> <span class="n">earlier</span> <span class="k">for</span> <span class="n">the</span> <span class="n">container</span> <span class="n">registry</span> <span class="kn">from</span> <span class="nn">Service</span> <span class="n">Accounts</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">it</span> <span class="n">will</span> <span class="n">look</span> <span class="n">something</span> <span class="n">like</span> <span class="n">the</span> <span class="n">following</span> <span class="p">(</span><span class="k">with</span> <span class="n">actual</span> <span class="n">values</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">empty</span> <span class="n">strings</span><span class="p">)</span><span class="o">&gt;</span>
    <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;project_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;private_key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;private_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_email&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;token_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_provider_x509_cert_url&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_x509_cert_url&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">}</span>
<span class="n">hub</span><span class="p">:</span>
  <span class="n">services</span><span class="p">:</span>
    <span class="n">binder</span><span class="p">:</span>
      <span class="n">apiToken</span><span class="p">:</span> <span class="s2">&quot;&lt;output of FIRST `openssl rand -hex 32` command&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<ul class="last simple">
<li>The content you put just after <code class="docutils literal"><span class="pre">password:</span> <span class="pre">|</span></code> must all line up at the same
tab level.</li>
<li>Don’t forget the <code class="docutils literal"><span class="pre">|</span></code> after the <code class="docutils literal"><span class="pre">password:</span></code> label.</li>
</ul>
</div>
</div>
<div class="section" id="create-config-yaml">
<h2>3.3. Create <code class="docutils literal"><span class="pre">config.yaml</span></code><a class="headerlink" href="#create-config-yaml" title="Permalink to this headline">¶</a></h2>
<p>Create a file called <code class="docutils literal"><span class="pre">config.yaml</span></code> and enter the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="p">:</span>
  <span class="n">prefix</span><span class="p">:</span>  <span class="n">gcr</span><span class="o">.</span><span class="n">io</span><span class="o">/&lt;</span><span class="n">google</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;/&lt;</span><span class="n">prefix</span><span class="o">&gt;</span>
  <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>

<span class="n">rbac</span><span class="p">:</span>
   <span class="n">enabled</span><span class="p">:</span> <span class="n">false</span>
<span class="n">jupyterhub</span><span class="p">:</span>
   <span class="n">hub</span><span class="p">:</span>
      <span class="n">rbac</span><span class="p">:</span>
         <span class="n">enabled</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><strong>``&lt;google-project-id&gt;``</strong> can be found in the JSON file that you
pasted above. It is the text that is in the <code class="docutils literal"><span class="pre">project_id</span></code> field. This is
the project <em>ID</em>, which may be different from the project <em>name</em>.</li>
<li><strong>``&lt;prefix&gt;``</strong> can be any string, and will be prepended to image names. We
recommend something descriptive such as <code class="docutils literal"><span class="pre">dev</span></code> or <code class="docutils literal"><span class="pre">prod</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="install-binderhub">
<h2>3.4. Install BinderHub<a class="headerlink" href="#install-binderhub" title="Permalink to this headline">¶</a></h2>
<p>First, get the latest helm chart for BinderHub.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">repo</span> <span class="n">add</span> <span class="n">jupyterhub</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jupyterhub</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">helm</span><span class="o">-</span><span class="n">chart</span>
<span class="n">helm</span> <span class="n">repo</span> <span class="n">update</span>
</pre></div>
</div>
<p>Next, <strong>install the Helm Chart</strong> using the configuration files
that you’ve just created. Do this by running the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">install</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">binderhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=</span><span class="n">v0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">397</span><span class="n">eb59</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">binder</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">binder</span> <span class="o">-</span><span class="n">f</span> <span class="n">secret</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">--version</span></code> refers to the version of the BinderHub <strong>Helm Chart</strong>.</li>
<li><code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">namespace</span></code> may be different, but we recommend using
the same <code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">namespace</span></code> to avoid confusion. We recommend
something descriptive and short.</li>
</ul>
</div>
<p>This installation step will deploy both a BinderHub and a JupyterHub, but
they are not yet set up to communicate with each other. We’ll fix this in
the next step. Wait a few moments before moving on as the resources may take a
few minutes to be set up.</p>
</div>
<div class="section" id="connect-binderhub-and-jupyterhub">
<h2>3.5. Connect BinderHub and JupyterHub<a class="headerlink" href="#connect-binderhub-and-jupyterhub" title="Permalink to this headline">¶</a></h2>
<p>In the google console, run the following command to print the IP address
of the JupyterHub we just deployed.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">binder</span> <span class="n">get</span> <span class="n">svc</span> <span class="n">proxy</span><span class="o">-</span><span class="n">public</span>
</pre></div>
</div>
<p>Copy the IP address under <code class="docutils literal"><span class="pre">EXTERNAL-IP</span></code>. This is the IP of your
JupyterHub. Now, add the following lines to <code class="docutils literal"><span class="pre">config.yaml</span></code> file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hub</span><span class="p">:</span>
  <span class="n">url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">IP</span> <span class="ow">in</span> <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next, upgrade the helm chart to deploy this change:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="n">binder</span> <span class="n">jupyterhub</span><span class="o">/</span><span class="n">binderhub</span> <span class="o">--</span><span class="n">version</span><span class="o">=</span><span class="n">v0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">397</span><span class="n">eb59</span> <span class="o">-</span><span class="n">f</span> <span class="n">secret</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">f</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="try-out-your-binderhub-deployment">
<h2>3.6. Try out your BinderHub Deployment<a class="headerlink" href="#try-out-your-binderhub-deployment" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal"><span class="pre">helm</span> <span class="pre">upgrade</span></code> command above succeeds, it’s time to try out your
BinderHub deployment.</p>
<p>First, find the IP address of the BinderHub deployment by running the following
command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">binder</span> <span class="n">get</span> <span class="n">svc</span> <span class="n">binder</span>
</pre></div>
</div>
<p>Note the IP address in <code class="docutils literal"><span class="pre">EXTERNAL-IP</span></code>. This is your BinderHub IP address.
Type this IP address in your browser and a BinderHub should be waiting there
for you.</p>
<p>You now have a functioning BinderHub at the above IP address.</p>
</div>
<div class="section" id="increase-your-github-api-limit">
<span id="api-limit"></span><h2>3.7. Increase your GitHub API limit<a class="headerlink" href="#increase-your-github-api-limit" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Increasing the GitHub API limit is not strictly required, but is recommended
before sharing your BinderHub URL with users.</p>
</div>
<p>By default GitHub only lets you make 60 requests each hour. If you
expect your users to serve repositories hosted on GitHub, we recommend creating
an API access token to raise your API limit to 5000 requests an hour.</p>
<ol class="arabic">
<li><p class="first">Create a new token with default (check no boxes)
permissions <a class="reference external" href="https://github.com/settings/tokens/new">here</a>.</p>
</li>
<li><p class="first">Store your new token somewhere secure (e.g. keychain, netrc, etc.)</p>
</li>
<li><p class="first">Before running your BinderHub server, run the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">GITHUB_ACCESS_TOKEN</span><span class="o">=&lt;</span><span class="n">insert_token_value_here</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
<p>BinderHub will automatically use the token stored in this variable when making
API requests to GitHub. See the <a class="reference external" href="https://developer.github.com/v3/guides/getting-started/#authentication">GitHub authentication documentation</a> for
more information about API limits.</p>
<p>For next steps, see <a class="reference internal" href="debug.html"><span class="doc">Debugging BinderHub</span></a> and <a class="reference internal" href="turn-off.html"><span class="doc">Tear down your Binder deployment</span></a>.</p>
</div>
</div>


  <div class='prev-next-bottom'>
    
     <a class='left-prev' href="create-cloud-resources.html" title="previous chapter">2. Create your cloud resources</a>
     <a class='right-next' href="debug.html" title="next chapter">4. Debugging BinderHub</a>
  <div style='clear:both;'></div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">BinderHub</a></h1>



<p class="blurb">A project to build and serve Binders</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=binderhub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="diagram.html">1. The BinderHub Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-cloud-resources.html">2. Create your cloud resources</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Set up BinderHub</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparing-to-install">3.1. Preparing to install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-secret-yaml-file">3.2. Create <code class="docutils literal"><span class="pre">secret.yaml</span></code> file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-config-yaml">3.3. Create <code class="docutils literal"><span class="pre">config.yaml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-binderhub">3.4. Install BinderHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-binderhub-and-jupyterhub">3.5. Connect BinderHub and JupyterHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#try-out-your-binderhub-deployment">3.6. Try out your BinderHub Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#increase-your-github-api-limit">3.7. Increase your GitHub API limit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">4. Debugging BinderHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn-off.html">5. Tear down your Binder deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">6. BinderHub API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/ref-index.html">7. Configuration and Source Code Reference</a></li>
</ul>


<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="create-cloud-resources.html" title="Previous">Previous topic</a></li>
  <li><a href="debug.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/setup-binderhub.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, The Jupyter Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/setup-binderhub.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>